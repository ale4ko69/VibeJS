/**
* Vibe.
* (c) 2021 Bret Lowry
* @license MIT
* @description VibeJS a component library for composing apps
* @author Bret Lowry <bretgeek@gmail.com>
* @constructor
* @param {object} $self - optional, defaults to document.
* @return {object} obj with keys pointing to functions and types
*/
function Vibe(e=document,{fn:t={}}={}){let n=false;if(e.nodeName==="#document"){n=true}let r=false;if(n){(function e(){if(document.readyState!="loading"){r=true}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",(function(){r=true}))}else{document.attachEvent("onreadystatechange",(function(){if(document.readyState!="loading"){r=true}}))}})()}function i(e,t=3e3){let n;let i;let s=1;n=setInterval(()=>{if(r){clearInterval(n);clearTimeout(i);if(e&&P(e)&&s<=1){try{e();s++}catch(e){console.error(e)}}else{return true}}},6);i=setTimeout(()=>{r=true},t)}function s(e,{to:r="body",type:s="div",position:f="append",state:u={},props:a={},plugin:c={},events:l={},className:d="vibe"}={}){let h=r;if(!z(h)){h=document.querySelector(r)}if(P(e)){const t=e();if(n){}const p=document.createElement(`${s}`);p.$=new Vibe(p);if(t.template&&t.template.length){p.innerHTML=t.template}if(t.className&&t.className.length){p.classList.add(t.className)}p.classList.add(d);p.$plugin=c;if(t.fn){if(Object.keys(t.fn).length>0){p.$fn=t.fn}}p.$props=a;p.$self=p;if(t.state){p.$state=t.state;p.$origState=t.state}else{p.$state=u;p.$origState=u}if(t.events){if(Object.keys(t.events).length>0){p.$event=t.events;for(const e in p.$event){p.addEventListener(e,p.$event[e],true)}}}if(Object.keys(l).length>0){p.$event=l;for(const e in p.$event){p.addEventListener(e,p.$event[e],true)}}p.id=W();if(z(h)){i(o(p,h,f));p.$mountedTo=r}else{let e=0;const t=setInterval((function(){e++;if(z(h)){i(o(p,h,f));p.$mountedTo=r;clearInterval(t)}if(e>60){clearInterval(t);throw new Error(`Whoops! could not mount to ${r} element.`)}}),100)}if(P(t.init)){p.init=t.init;i(p.init(p))}return p}else{if(e.nodeType===1){e.$=new Vibe(e);e.$plugin=c;e.classList.add(d);e.$props=a;e.$self=e;e.$state=u;e.$origState=u;if(Object.keys(l).length>0){e.$event=l;for(const t in e.$event){e.addEventListener(t,e.$event[t],true)}}if(!e.id){e.id=W()}return e}else if(B(e)){let n=null;if(b(e)){let t;t=b(e,true);n=document.createElement(`${t[0]}`);n.innerHTML=t[1]}else{n=document.createElement(`${s}`);n.innerHTML=e}n.$=new Vibe(n);if(Object.keys(t).length>0){n.$fn=t}n.$props=a;n.$self=n;n.$obj=n.$;n.classList.add(d);n.$state=u;n.$origState=u;n.$plugin=c;if(Object.keys(l).length>0){n.$events=l;for(const e in n.$events){n.addEventListener(e,n.$events[e],true)}}n.id=W();i(o(n,h,f));return n}}}function o(e,t,n){switch(n){case"after":e.$insertAfter(t);break;case"before":e.$insertBefore(t);break;case"prepend":e.$prependTo(t);break;default:e.$appendTo(t);break}return this}function f(t="mousedown",n,r=false){let i=r;if(typeof r==="boolean"){if(r){i={capture:true}}else{i={capture:false}}}const s=t.split(",");for(let t of s){t=t.trim();e.addEventListener(t,n,i)}return this}function u(t="mousedown",n,r=false){const i=e;let s=r;if(typeof r==="boolean"){if(r){s={capture:true}}else{s={capture:false}}}const o=t.split(",");for(const e of o){i.removeEventListener(e,n,s)}return this}function a(t){const n=e;const r=new Event(t);n.dispatchEvent(r,{bubbles:true,cancelable:true});return this}function c(t,{all:n=false,vibe:r=false}={}){if(!n){const n=e.querySelectorAll(t)[0];if(n){if(r){n.$=new Vibe(n)}return n}else{return false}}else{const n=e.querySelectorAll(t);if(n.length){if(r){n.forEach(e=>{e.$=new Vibe(e)})}return n}else{return false}}}function l(e){e=e.toString();return Math.round(Number(e.replace(/px/g,"")))}function d(t,n=false){let r=getComputedStyle(e).getPropertyValue(t)||null;if(n){try{r=l(r)}catch(e){console.error(e)}}return r}function h(t=false,n=false){const r=["x","y","width","height","right","left","top","bottom"];if(!r.includes(t)){return null}const i=e.getBoundingClientRect()[t];if(n){return Math.round(i)}else{return i}}function p(e){const t=document.createElement(e[0]);t.innerHTML=e[1];return t}function b(e,t=false){const n=(new DOMParser).parseFromString(e,"text/html");if(t){return[n.body.childNodes[0].tagName.toLowerCase(),n.body.childNodes[0].innerHTML]}else{return Array.from(n.body.childNodes).some(e=>e.nodeType===1)}}function m(t=false){if(n){return this}if(!t){return e.textContent}else{e.textContent=t;return this}}function $(t=false){if(n){return this}if(!t){return e.innerHTML}else{e.innerHTML=t;return this}}function v(e){w(e);return this}function g(e){w(e,true);return this}function y(e){w(e,true,true);return this}function x(e){w(e,false,true);return this}function w(t,r=false,i=false){if(n){return this}const s=e;if(B(t)){let e;if(b(t)){e=p(b(t,true),true);if(!e){return this}}else{e=document.querySelectorAll(t)[0];if(!e){return this}}if(r){if(i){e.before(s)}else{s.before(e)}}else{if(i){e.after(s)}else{s.after(e)}}}if(z(t)){if(r){if(i){t.before(s)}else{s.before(t)}}else{if(i){t.after(s)}else{s.after(t)}}}return this}function T(t,r=false){if(n){return this}const i=e;if(!t){return this}if(B(t)){let e;if(b(t)){e=p(b(t,true),true)}else{e=t}if(r){i.prepend(e)}else{i.append(e)}}else{if(r){i.prepend(t)}else{i.append(t)}}return this}function L(e){if(n){return this}if(!e){return this}T(e,true);return this}function E(e){if(!e){return this}k(e,true);return this}function S(e){if(!e){return this}k(e);return this}function k(t,r=false){if(n){e=e.body}const i=e;if(B(t)){const e=document.querySelectorAll(t)[0];if(!e){return this}if(r){e.prepend(i)}else{e.append(i)}}if(z(t)){if(r){t.prepend(i)}else{t.append(i)}return this}}function A(t){if(n){return this}if(!t){return this}e.style.cssText=t;return this}function V(t="div",{override:r=false,position:i=false,to:s=false}={}){const o=["html","head","link","meta","script","style","title","body","article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","div","figure","hr","li","ol","p","pre","ul","a","code","data","time","em","i","span","strong","audio","source","img","track","video","iframe","svg","canvas","noscript","col","colgroup","button","option","fieldset","label","form","input","select","textarea","menu","template"];if(!o.includes(t)){if(!r){t="div"}}const f=document.createElement(t);const u=f;u.$=Vibe().render(f);if(!s){s=e}if(n&&!s){return u}if(!z(s)){s=document.querySelector(s)}if(n){if(!s){s=document.body}if(i){if(i!=="prepend"){if(i!=="append"){i="append"}}}}if(i&&s){switch(i){case"after":u.$insertAfter(s);break;case"before":u.$insertBefore(s);break;case"prepend":u.$prependTo(s);break;default:u.$appendTo(s);break}return u}else{return u}}function O(t=false){if(n){return this}let r=false;let i="";if(t){i=e.id;r=e.cloneNode(true)}e.remove();if(t){r.$=new Vibe(r);r.id=i;return r}else{return this}}function M({to:t=false,position:r="append"}={}){if(n){return this}const s=e.cloneNode(true);s.$=new Vibe(s);s.id=W();if(t){if(!z(t)){t=document.querySelector(t)}i(o(s,t,r))}return s}function j(t,r=false){if(n){return this}const i=e;if(!r){i.classList.add(t)}else{i.classList.remove(t)}return this}function N(e){if(n){return this}j(e,true);return this}function q(e){if(n){return this}C(e,false,true);return this}function C(t,r=false,i=false){if(n){return this}const s=e;if(t&&B(t)){if(i){s.removeAttribute(t);return this}if(B(r)||typeof r==="number"){s.setAttribute(t,r);return this}if(!r){const e=s.getAttribute(t);return e}}}function H(){if(n){return this}return e.dataset}function D(t,r="set"){const i=e;if(n){return this}if(r==="remove"){i.removeAttribute("data-"+t)}if(r==="set"){i.setAttribute("data-"+t,t)}if(r==="get"){return i.getAttribute("data-"+t)}}function I({str:t=false,fn:r=false,vibe:i=true}={}){if(n){return this}if(B(t)){const n=[];console.log("str:"+t);for(let s=0;s<e.children.length;s++){if(e.children[s].matches(t)){console.log("matches");if(P(r)){r(e.children[s])}const t=e.children[s];if(i){t.$=new Vibe(t)}n.push(t)}}return n}else{if(P(r)){for(let t=0;t<e.children.length;t++){if(P(r)){r(e.children[t])}if(i){e.children[t].$=new Vibe(e.children[t])}carr.push(e.children[t])}}return carr}}function B(e){return typeof e==="string"}function F(e){return/^-{0,1}\d+$/.test(e)}function P(e){return typeof e==="function"}function R(e){return typeof e==="object"}function z(e){return R(e)&&e.nodeType==1}function U(e){if(Array.isArray(e)){return true}else{return false}}function W(){if(R(crypto)){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}else{let e=(new Date).getTime();let t=performance&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let r=Math.random()*16;if(e>0){r=(e+r)%16|0;e=Math.floor(e/16)}else{r=(t+r)%16|0;t=Math.floor(t/16)}return(n=="x"?r:r&7|8).toString(16)})}}function G(e,t=false){e=e.replace(/[^\x20-\x7E]+/g,"");if(t){e=e.replace(/[^a-z0-9-#]+|\s+/gim,"")}e=e.trim();return e}function J(){if(n){return this}return e.id}function K(t){if(P(t)){const r=t.name;if(n){document.$plugin[r]=t}else{e.$plugin[r]=t}}return this}function Q(t){if(P(t)){t(e)}return this}function X(t={}){if(n){return this}e.$state=t}function Y(t){if(n){return this}return e.$state[t]}function Z(t,n="name",{delay:r=10,child:i=true,attr:s=true,subtree:o=false,attrs:f=["none"],chardat:u=false,attrsOV:a=false,chardatOV:c=false}){if(typeof t!=="function"){return}const l={childList:i,attributes:s,characterData:u,subtree:o,attributeFilter:f,attributeOldValue:a,characterDataOldValue:c};const d=e;const h=new MutationObserver((function(e){e.forEach((function(e){if(e.type==="attributes"){if(f[0]!=="none"){setTimeout(()=>{t(d)},r)}}else{if(f[0]==="none"){if(e.type==="childList"||e.type==="subtree"||e.type==="characterData"){setTimeout(()=>{t(d)},r)}}}}))}));if(e.$observers[n]){e.$observers[n].disconnect();delete e.$observers[n]}e.$observers[n]=h;e.$observers[n].observe(e,l);const p=Object.keys(e.$observers);return this}function _(t="name"){if(t==="all"){const t=Object.keys(e.$observers);for(const n of t){delete e.$observers[n];n.disconnect()}}else{if(e.$observers[t]){e.$observers[t].disconnect();delete e.$observers[t]}}return this}function ee(){const t=Object.keys(e.$observers);return t}async function te({url:e=false,type:t="json",fn:n=false,e:r={}}={}){const i=await fetch(e);let s;if(t=="json"){s=await i.json()}if(t=="text"){s=await i.text()}if(P(n)){n(s,r)}}function ne(){return window.matchMedia("(pointer: coarse)").matches||false}function re(){setTimeout((function(){e.onfocus=blur()}),100);return this}const ie={fn:t,id:J,clone:M,ready:i,get:te,css:A,isTouch:ne,rpx:l,addClass:j,removeClass:N,children:I,before:g,insertBefore:y,insertAfter:x,after:v,append:T,prepend:L,select:c,attr:C,removeAttr:q,appendTo:S,prependTo:E,createNode:V,filterString:G,dataset:H,data:D,detach:O,render:s,addplug:K,run:Q,plugin:{},doc:document,rect:h,mountedTo:false,cs:d,on:f,observe:Z,observers:{},unobserve:_,getobservers:ee,off:u,trigger:a,html:$,text:m,getState:Y,setState:X,isFunction:P,isObject:R,isElement:z,isArray:U,isNumber:F};for(const t in ie){const n="$"+t;e[n]=ie[t]}return ie}var $vibe=new Vibe(document);
